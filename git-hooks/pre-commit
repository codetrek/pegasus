#!/usr/bin/env bash
# Pre-commit hook: run typecheck and tests before committing.
set -euo pipefail

# Prevent direct commits to main branch
BRANCH=$(git symbolic-ref --short HEAD 2>/dev/null || echo "detached")
if [ "$BRANCH" = "main" ]; then
  echo "âŒ Direct commits to main branch are not allowed!"
  echo "   Please create a feature branch instead:"
  echo "   git checkout -b feature/your-feature-name"
  exit 1
fi

echo "ğŸ” Running typecheck..."
bunx tsc --noEmit

echo "ğŸ§ª Running tests..."
PEGASUS_LOG_LEVEL=silent bun test

echo "âœ… All checks passed."
